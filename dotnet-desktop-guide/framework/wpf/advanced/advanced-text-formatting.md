---
title: テキストの高度な書式設定
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- formatting [WPF]
- text [WPF]
- typography [WPF], text formatting
ms.assetid: f0a7986e-f5b2-485c-a27d-f8e922022212
ms.openlocfilehash: 662d01d892f6ee4ca8a9e19fca06e822cec00ff5
ms.sourcegitcommit: 9f6df084c53a3da0ea657ed0d708a72213683084
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/09/2020
ms.locfileid: "96984408"
---
# <a name="advanced-text-formatting"></a><span data-ttu-id="2fcc0-102">テキストの高度な書式設定</span><span class="sxs-lookup"><span data-stu-id="2fcc0-102">Advanced Text Formatting</span></span>
<span data-ttu-id="2fcc0-103">Windows Presentation Foundation (WPF) では、アプリケーションにテキストを含めるための堅牢な API のセットが提供されています。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-103">Windows Presentation Foundation (WPF) provides a robust set of APIs for including text in your application.</span></span> <span data-ttu-id="2fcc0-104">レイアウトと <xref:System.Windows.Controls.TextBlock> のような [!INCLUDE[TLA#tla_ui](../../../includes/tlasharptla-ui-md.md)] API により、テキスト表示のための最も一般的な要素が提供されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-104">Layout and [!INCLUDE[TLA#tla_ui](../../../includes/tlasharptla-ui-md.md)] APIs, such as <xref:System.Windows.Controls.TextBlock>, provide the most common and general-use elements for text presentation.</span></span> <span data-ttu-id="2fcc0-105"><xref:System.Windows.Media.GlyphRunDrawing> や <xref:System.Windows.Media.FormattedText> のような描画 API は、描画に書式設定されたテキストを追加する手段です。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-105">Drawing APIs, such as <xref:System.Windows.Media.GlyphRunDrawing> and <xref:System.Windows.Media.FormattedText>, provide a means for including formatted text in drawings.</span></span> <span data-ttu-id="2fcc0-106">最も高度なレベルでは、WPF によって提供される拡張テキスト書式設定エンジンにより、テキスト保管管理、テキスト ラン書式設定管理、埋め込みオブジェクト管理など、テキスト表示のあらゆる側面が制御されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-106">At the most advanced level, WPF provides an extensible text formatting engine to control every aspect of text presentation, such as text store management, text run formatting management, and embedded object management.</span></span>  
  
 <span data-ttu-id="2fcc0-107">このトピックでは、WPF でのテキスト書式設定の概要について説明します。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-107">This topic provides an introduction to WPF text formatting.</span></span> <span data-ttu-id="2fcc0-108">WPF のテキスト書式設定エンジンのクライアントでの実装と使用について主に取り上げます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-108">It focuses on client implementation and use of the WPF text formatting engine.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="2fcc0-109">ドキュメント内のすべてのコード サンプルは、「[テキストの高度な書式設定サンプル](https://github.com/Microsoft/WPF-Samples/tree/master/PerMonitorDPI/TextFormatting)」にあります。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-109">All code examples within this document can be found in the [Advanced Text Formatting Sample](https://github.com/Microsoft/WPF-Samples/tree/master/PerMonitorDPI/TextFormatting).</span></span>  

<a name="prereq"></a>
## <a name="prerequisites"></a><span data-ttu-id="2fcc0-110">必須コンポーネント</span><span class="sxs-lookup"><span data-stu-id="2fcc0-110">Prerequisites</span></span>  
 <span data-ttu-id="2fcc0-111">このトピックは、テキスト表示に使用されるレベルの高い API に関する知識があることを前提に書かれています。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-111">This topic assumes that you are familiar with the higher level APIs used for text presentation.</span></span> <span data-ttu-id="2fcc0-112">ほとんどのユーザー シナリオでは、このトピックにあるようなテキストの高度な書式設定 API は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-112">Most user scenarios will not require the advanced text formatting APIs discussed in this topic.</span></span> <span data-ttu-id="2fcc0-113">他のテキスト API の概要については、「[WPF のドキュメント](documents-in-wpf.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-113">For an introduction to the different text APIs, see [Documents in WPF](documents-in-wpf.md).</span></span>  
  
<a name="section1"></a>
## <a name="advanced-text-formatting"></a><span data-ttu-id="2fcc0-114">テキストの高度な書式設定</span><span class="sxs-lookup"><span data-stu-id="2fcc0-114">Advanced Text Formatting</span></span>  
 <span data-ttu-id="2fcc0-115">WPF のテキスト レイアウトと [!INCLUDE[TLA2#tla_ui](../../../includes/tla2sharptla-ui-md.md)] のコントロールによって提供される書式設定プロパティを使用すると、書式設定されたテキストをアプリケーションに簡単に追加できます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-115">The text layout and [!INCLUDE[TLA2#tla_ui](../../../includes/tla2sharptla-ui-md.md)] controls in WPF provide formatting properties that allow you to easily include formatted text in your application.</span></span> <span data-ttu-id="2fcc0-116">これらのコントロールでは、テキストの表示を処理するさまざまなプロパティが公開されます。書体、大きさ、色などです。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-116">These controls expose a number of properties to handle the presentation of text, which includes its typeface, size, and color.</span></span> <span data-ttu-id="2fcc0-117">通常の状況では、これらのコントロールはアプリケーションの大半のテキスト表示を処理できます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-117">Under ordinary circumstances, these controls can handle the majority of text presentation in your application.</span></span> <span data-ttu-id="2fcc0-118">しかしながら、一部の高度なシナリオでは、テキスト表示と同様にテキスト保存を制御する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-118">However, some advanced scenarios require the control of text storage as well as text presentation.</span></span> <span data-ttu-id="2fcc0-119">WPF では、この目的のための拡張テキスト書式設定エンジンが提供されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-119">WPF provides an extensible text formatting engine for this purpose.</span></span>  
  
 <span data-ttu-id="2fcc0-120">WPF の高度なテキスト書式設定機能は、テキスト書式設定エンジン、テキスト ストア、テキスト ラン、書式設定プロパティで構成されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-120">The advanced text formatting features found in WPF consist of a text formatting engine, a text store, text runs, and formatting properties.</span></span> <span data-ttu-id="2fcc0-121">テキスト書式設定エンジン <xref:System.Windows.Media.TextFormatting.TextFormatter> では、表示に使用されるテキスト行が作成されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-121">The text formatting engine, <xref:System.Windows.Media.TextFormatting.TextFormatter>, creates lines of text to be used for presentation.</span></span> <span data-ttu-id="2fcc0-122">これは、行の書式設定プロセスを開始し、テキスト フォーマッタの <xref:System.Windows.Media.TextFormatting.TextFormatter.FormatLine%2A> を呼び出すことで行われます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-122">This is achieved by initiating the line formatting process and calling the text formatter's <xref:System.Windows.Media.TextFormatting.TextFormatter.FormatLine%2A>.</span></span> <span data-ttu-id="2fcc0-123">テキスト フォーマッタでは、テキスト ストアの <xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> メソッドを呼び出すことによって、ストアからテキスト ランが取得されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-123">The text formatter retrieves text runs from your text store by calling the store's <xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> method.</span></span> <span data-ttu-id="2fcc0-124">次に、テキスト フォーマッタにより <xref:System.Windows.Media.TextFormatting.TextRun> オブジェクトから書式設定された <xref:System.Windows.Media.TextFormatting.TextLine> オブジェクトが作成されて、検査または表示のためにアプリケーションに提供されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-124">The <xref:System.Windows.Media.TextFormatting.TextRun> objects are then formed into <xref:System.Windows.Media.TextFormatting.TextLine> objects by the text formatter and given to your application for inspection or display.</span></span>  
  
<a name="section2"></a>
## <a name="using-the-text-formatter"></a><span data-ttu-id="2fcc0-125">テキスト フォーマッタを使用する</span><span class="sxs-lookup"><span data-stu-id="2fcc0-125">Using the Text Formatter</span></span>  
 <span data-ttu-id="2fcc0-126"><xref:System.Windows.Media.TextFormatting.TextFormatter> は WPF のテキスト書式設定エンジンであり、テキスト行を書式設定したり、改行したりするためのサービスを提供します。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-126"><xref:System.Windows.Media.TextFormatting.TextFormatter> is the WPF text formatting engine and provides services for formatting and breaking text lines.</span></span> <span data-ttu-id="2fcc0-127">テキスト フォーマッタは、さまざまなテキスト文字書式や段落スタイルを処理し、国際的なテキスト レイアウトに対応しています。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-127">The text formatter can handle different text character formats and paragraph styles, and includes support for international text layout.</span></span>  
  
 <span data-ttu-id="2fcc0-128">従来のテキスト API とは異なり、<xref:System.Windows.Media.TextFormatting.TextFormatter> では、一連のコールバック メソッドにより、テキスト レイアウト クライアントとの対話が行われます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-128">Unlike a traditional text API, the <xref:System.Windows.Media.TextFormatting.TextFormatter> interacts with a text layout client through a set of callback methods.</span></span> <span data-ttu-id="2fcc0-129">クライアントでは、<xref:System.Windows.Media.TextFormatting.TextSource> クラスの実装で、これらのメソッドを提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-129">It requires the client to provide these methods in an implementation of the <xref:System.Windows.Media.TextFormatting.TextSource> class.</span></span> <span data-ttu-id="2fcc0-130">次の図は、クライアント アプリケーションと <xref:System.Windows.Media.TextFormatting.TextFormatter> の間で行われるテキスト レイアウトの相互作用を示したものです。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-130">The following diagram illustrates the text layout interaction between the client application and <xref:System.Windows.Media.TextFormatting.TextFormatter>.</span></span>  
  
 ![テキスト レイアウト クライアントと TextFormatter のダイアグラム](./media/advanced-text-formatting/text-layout-textformatter-interaction.png)  
  
 <span data-ttu-id="2fcc0-132">テキスト フォーマッタは、<xref:System.Windows.Media.TextFormatting.TextSource> の実装であるテキスト ストアから書式設定されたテキスト行を取得するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-132">The text formatter is used to retrieve formatted text lines from the text store, which is an implementation of <xref:System.Windows.Media.TextFormatting.TextSource>.</span></span> <span data-ttu-id="2fcc0-133">これは、最初に <xref:System.Windows.Media.TextFormatting.TextFormatter.Create%2A> メソッドを使用してテキスト フォーマッタのインスタンスを作成することで行われます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-133">This is done by first creating an instance of the text formatter by using the <xref:System.Windows.Media.TextFormatting.TextFormatter.Create%2A> method.</span></span> <span data-ttu-id="2fcc0-134">このメソッドはテキスト フォーマッタのインスタンスを作成し、行の高さと幅の最大値を設定します。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-134">This method creates an instance of the text formatter and sets the maximum line height and width values.</span></span> <span data-ttu-id="2fcc0-135">テキスト フォーマッタのインスタンスが作成されるとすぐに、<xref:System.Windows.Media.TextFormatting.TextFormatter.FormatLine%2A> メソッドが呼び出されることによって、行の作成プロセスが開始されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-135">As soon as an instance of the text formatter is created, the line creation process is started by calling the <xref:System.Windows.Media.TextFormatting.TextFormatter.FormatLine%2A> method.</span></span> <span data-ttu-id="2fcc0-136"><xref:System.Windows.Media.TextFormatting.TextFormatter> では、テキスト ソースが再び呼び出されて、行を形成するテキスト ランのテキストと書式設定パラメーターが取得されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-136"><xref:System.Windows.Media.TextFormatting.TextFormatter> calls back to the text source to retrieve the text and formatting parameters for the runs of text that form a line.</span></span>  
  
 <span data-ttu-id="2fcc0-137">次の例は、テキスト ストアを書式設定するプロセスを示しています。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-137">In the following example, the process of formatting a text store is shown.</span></span> <span data-ttu-id="2fcc0-138"><xref:System.Windows.Media.TextFormatting.TextFormatter> オブジェクトを使用して、テキスト ストアからテキスト行が取得された後、<xref:System.Windows.Media.DrawingContext> に描画するためのテキスト行の書式設定が行われます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-138">The <xref:System.Windows.Media.TextFormatting.TextFormatter> object is used to retrieve text lines from the text store and then format the text line for drawing into the <xref:System.Windows.Media.DrawingContext>.</span></span>  
  
 [!code-csharp[TextFormatterExample#100](~/samples/snippets/csharp/VS_Snippets_Wpf/TextFormatterExample/CSharp/Window1.xaml.cs#100)]
 [!code-vb[TextFormatterExample#100](~/samples/snippets/visualbasic/VS_Snippets_Wpf/TextFormatterExample/VisualBasic/Window1.xaml.vb#100)]  
  
<a name="section3"></a>
## <a name="implementing-the-client-text-store"></a><span data-ttu-id="2fcc0-139">クライアント テキスト ストアを実装する</span><span class="sxs-lookup"><span data-stu-id="2fcc0-139">Implementing the Client Text Store</span></span>  
 <span data-ttu-id="2fcc0-140">テキスト書式設定エンジンを拡張するとき、テキスト ストアのあらゆる側面を実装し、管理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-140">When you extend the text formatting engine, you are required to implement and manage all aspects of the text store.</span></span> <span data-ttu-id="2fcc0-141">これは簡単な作業ではありません。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-141">This is not a trivial task.</span></span> <span data-ttu-id="2fcc0-142">テキスト ストアは、テキスト ランのプロパティ、段落のプロパティ、埋め込みオブジェクト、その他の同様のコンテンツの追跡を担当します。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-142">The text store is responsible for tracking text run properties, paragraph properties, embedded objects, and other similar content.</span></span> <span data-ttu-id="2fcc0-143">また、テキスト フォーマッタに個々の <xref:System.Windows.Media.TextFormatting.TextRun> オブジェクトが提供されます。テキスト フォーマッタでは、このオブジェクトを使用して、<xref:System.Windows.Media.TextFormatting.TextLine> オブジェクトが作成されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-143">It also provides the text formatter with individual <xref:System.Windows.Media.TextFormatting.TextRun> objects which the text formatter uses to create <xref:System.Windows.Media.TextFormatting.TextLine> objects.</span></span>  
  
 <span data-ttu-id="2fcc0-144">テキスト ストアの仮想化を処理するため、テキスト ストアは <xref:System.Windows.Media.TextFormatting.TextSource> から派生される必要があります。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-144">To handle the virtualization of the text store, the text store must be derived from <xref:System.Windows.Media.TextFormatting.TextSource>.</span></span> <span data-ttu-id="2fcc0-145"><xref:System.Windows.Media.TextFormatting.TextSource> では、テキスト ストアからテキスト ランを取得するためにテキスト フォーマッタによって使用されるメソッドが定義されています。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-145"><xref:System.Windows.Media.TextFormatting.TextSource> defines the method the text formatter uses to retrieve text runs from the text store.</span></span> <span data-ttu-id="2fcc0-146"><xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> は、行の書式設定で使用されるテキスト ランを取得するためにテキスト フォーマッタによって使用されるメソッドです。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-146"><xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> is the method used by the text formatter to retrieve text runs used in line formatting.</span></span> <span data-ttu-id="2fcc0-147">次のいずれかの条件が発生するまで、テキスト フォーマッタによって <xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> が繰り返し呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-147">The call to <xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> is repeatedly made by the text formatter until one of the following conditions occurs:</span></span>  
  
- <span data-ttu-id="2fcc0-148"><xref:System.Windows.Media.TextFormatting.TextEndOfLine> またはサブクラスが返される。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-148">A <xref:System.Windows.Media.TextFormatting.TextEndOfLine> or a subclass is returned.</span></span>  
  
- <span data-ttu-id="2fcc0-149">テキスト ランの累積の幅が、テキスト フォーマッタを作成するための呼び出し、またはテキスト フォーマッタの <xref:System.Windows.Media.TextFormatting.TextFormatter.FormatLine%2A> メソッドの呼び出しのいずれかで指定されている行の最大幅を超過する。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-149">The accumulated width of text runs exceeds the maximum line width specified in either the call to create the text formatter or the call to the text formatter's <xref:System.Windows.Media.TextFormatting.TextFormatter.FormatLine%2A> method.</span></span>  
  
- <span data-ttu-id="2fcc0-150">"CF"、"LF"、"CRLF" など、Unicode の改行シーケンスが返される。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-150">A Unicode newline sequence, such as "CF", "LF", or "CRLF", is returned.</span></span>  
  
<a name="section4"></a>
## <a name="providing-text-runs"></a><span data-ttu-id="2fcc0-151">テキスト ランを提供する</span><span class="sxs-lookup"><span data-stu-id="2fcc0-151">Providing Text Runs</span></span>  
 <span data-ttu-id="2fcc0-152">テキスト書式設定プロセスの中心となるものは、テキスト フォーマッタとテキスト ストアの間のやりとりです。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-152">The core of the text formatting process is the interaction between the text formatter and the text store.</span></span> <span data-ttu-id="2fcc0-153"><xref:System.Windows.Media.TextFormatting.TextSource> の実装で、テキスト フォーマッタに、<xref:System.Windows.Media.TextFormatting.TextRun> オブジェクトとテキスト ランの書式設定プロパティを提供します。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-153">Your implementation of <xref:System.Windows.Media.TextFormatting.TextSource> provides the text formatter with the <xref:System.Windows.Media.TextFormatting.TextRun> objects and the properties with which to format the text runs.</span></span> <span data-ttu-id="2fcc0-154">このやりとりは、テキスト フォーマッタによって呼び出される <xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> メソッドで処理されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-154">This interaction is handled by the <xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> method, which is called by the text formatter.</span></span>  
  
 <span data-ttu-id="2fcc0-155">次の表では、事前定義されている <xref:System.Windows.Media.TextFormatting.TextRun> オブジェクトの一部を示します。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-155">The following table shows some of the predefined <xref:System.Windows.Media.TextFormatting.TextRun> objects.</span></span>  
  
|<span data-ttu-id="2fcc0-156">TextRun の種類</span><span class="sxs-lookup"><span data-stu-id="2fcc0-156">TextRun Type</span></span>|<span data-ttu-id="2fcc0-157">使用方法</span><span class="sxs-lookup"><span data-stu-id="2fcc0-157">Usage</span></span>|  
|------------------|-----------|  
|<xref:System.Windows.Media.TextFormatting.TextCharacters>|<span data-ttu-id="2fcc0-158">文字グリフの表示をテキスト フォーマッタに返すために使用される特殊なテキスト ラン。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-158">The specialized text run used to pass a representation of character glyphs back to the text formatter.</span></span>|  
|<xref:System.Windows.Media.TextFormatting.TextEmbeddedObject>|<span data-ttu-id="2fcc0-159">テキスト内のボタンやイメージなど、測定、ヒット テスト、描画が全部行われるコンテンツを提供するための特殊なテキスト ラン。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-159">The specialized text run used to provide content in which measuring, hit testing, and drawing is done in whole, such as a button or image within the text.</span></span>|  
|<xref:System.Windows.Media.TextFormatting.TextEndOfLine>|<span data-ttu-id="2fcc0-160">行の終わりをマークするための特殊なテキスト ラン。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-160">The specialized text run used to mark the end of a line.</span></span>|  
|<xref:System.Windows.Media.TextFormatting.TextEndOfParagraph>|<span data-ttu-id="2fcc0-161">段落の終わりをマークするための特殊なテキスト ラン。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-161">The specialized text run used to mark the end of a paragraph.</span></span>|  
|<xref:System.Windows.Media.TextFormatting.TextEndOfSegment>|<span data-ttu-id="2fcc0-162">前の <xref:System.Windows.Media.TextFormatting.TextModifier> ランの影響を受ける範囲の終わりなど、セグメントの終わりをマークするための特殊なテキスト ラン。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-162">The specialized text run used to mark the end of a segment, such as to end the scope affected by a previous <xref:System.Windows.Media.TextFormatting.TextModifier> run.</span></span>|  
|<xref:System.Windows.Media.TextFormatting.TextHidden>|<span data-ttu-id="2fcc0-163">隠れ文字の範囲をマークするための特殊なテキスト ラン。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-163">The specialized text run used to mark a range of hidden characters.</span></span>|  
|<xref:System.Windows.Media.TextFormatting.TextModifier>|<span data-ttu-id="2fcc0-164">その範囲でテキスト ランのプロパティを変更するための特殊なテキスト ラン。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-164">The specialized text run used to modify properties of text runs in its scope.</span></span> <span data-ttu-id="2fcc0-165">範囲は、次に一致する <xref:System.Windows.Media.TextFormatting.TextEndOfSegment> テキスト ランまで、または次の <xref:System.Windows.Media.TextFormatting.TextEndOfParagraph> まで拡張されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-165">The scope extends to the next matching <xref:System.Windows.Media.TextFormatting.TextEndOfSegment> text run, or the next <xref:System.Windows.Media.TextFormatting.TextEndOfParagraph>.</span></span>|  
  
 <span data-ttu-id="2fcc0-166">事前定義されている <xref:System.Windows.Media.TextFormatting.TextRun> オブジェクトのどれでもサブクラス化できます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-166">Any of the predefined <xref:System.Windows.Media.TextFormatting.TextRun> objects can be subclassed.</span></span> <span data-ttu-id="2fcc0-167">それにより、テキスト ソースはテキスト フォーマッタにカスタム データを含むテキスト ランを提供できます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-167">This allows your text source to provide the text formatter with text runs that include custom data.</span></span>  
  
 <span data-ttu-id="2fcc0-168"><xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> メソッドの例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-168">The following example demonstrates a <xref:System.Windows.Media.TextFormatting.TextSource.GetTextRun%2A> method.</span></span> <span data-ttu-id="2fcc0-169">このテキスト ストアでは、処理のためにテキスト フォーマッタに <xref:System.Windows.Media.TextFormatting.TextRun> オブジェクトが返されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-169">This text store returns <xref:System.Windows.Media.TextFormatting.TextRun> objects to the text formatter for processing.</span></span>  
  
 [!code-csharp[TextFormatterExample#101](~/samples/snippets/csharp/VS_Snippets_Wpf/TextFormatterExample/CSharp/CustomTextSource.cs#101)]
 [!code-vb[TextFormatterExample#101](~/samples/snippets/visualbasic/VS_Snippets_Wpf/TextFormatterExample/VisualBasic/CustomTextSource.vb#101)]  
  
> [!NOTE]
> <span data-ttu-id="2fcc0-170">この例では、テキスト ストアはすべてのテキストに同じテキスト プロパティを提供します。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-170">In this example, the text store provides the same text properties to all of the text.</span></span> <span data-ttu-id="2fcc0-171">高度なテキスト ストアでは、場合によっては、独自のスパン管理を実装し、個々の文字に異なるプロパティを与えるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-171">Advanced text stores would need to implement their own span management to allow individual characters to have different properties.</span></span>  
  
<a name="section5"></a>
## <a name="specifying-formatting-properties"></a><span data-ttu-id="2fcc0-172">書式設定プロパティを指定する</span><span class="sxs-lookup"><span data-stu-id="2fcc0-172">Specifying Formatting Properties</span></span>  
 <span data-ttu-id="2fcc0-173"><xref:System.Windows.Media.TextFormatting.TextRun> オブジェクトは、テキスト ストアによって提供されるプロパティを使用して書式設定されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-173"><xref:System.Windows.Media.TextFormatting.TextRun> objects are formatted by using properties provided by the text store.</span></span> <span data-ttu-id="2fcc0-174">これらのプロパティは、<xref:System.Windows.Media.TextFormatting.TextParagraphProperties> と <xref:System.Windows.Media.TextFormatting.TextRunProperties> の 2 つの型で渡されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-174">These properties come in two types, <xref:System.Windows.Media.TextFormatting.TextParagraphProperties> and <xref:System.Windows.Media.TextFormatting.TextRunProperties>.</span></span> <span data-ttu-id="2fcc0-175"><xref:System.Windows.Media.TextFormatting.TextParagraphProperties> では、<xref:System.Windows.TextAlignment> や <xref:System.Windows.FlowDirection> などの段落の包括的プロパティが処理されます。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-175"><xref:System.Windows.Media.TextFormatting.TextParagraphProperties> handle paragraph inclusive properties such as <xref:System.Windows.TextAlignment> and <xref:System.Windows.FlowDirection>.</span></span> <span data-ttu-id="2fcc0-176"><xref:System.Windows.Media.TextFormatting.TextRunProperties> は、前景ブラシ、<xref:System.Windows.Media.Typeface>、フォント サイズなど、段落内のテキスト ランごとに異なる場合があるプロパティです。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-176"><xref:System.Windows.Media.TextFormatting.TextRunProperties> are properties that can be different for each text run within a paragraph, such as foreground brush, <xref:System.Windows.Media.Typeface>, and font size.</span></span> <span data-ttu-id="2fcc0-177">カスタム段落やカスタム テキストのラン プロパティ型を実装するには、アプリケーションでそれぞれ <xref:System.Windows.Media.TextFormatting.TextParagraphProperties> および <xref:System.Windows.Media.TextFormatting.TextRunProperties> から派生するクラスを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2fcc0-177">To implement custom paragraph and custom text run property types, your application must create classes that derive from <xref:System.Windows.Media.TextFormatting.TextParagraphProperties> and <xref:System.Windows.Media.TextFormatting.TextRunProperties> respectively.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2fcc0-178">関連項目</span><span class="sxs-lookup"><span data-stu-id="2fcc0-178">See also</span></span>

- [<span data-ttu-id="2fcc0-179">WPF のタイポグラフィ</span><span class="sxs-lookup"><span data-stu-id="2fcc0-179">Typography in WPF</span></span>](typography-in-wpf.md)
- [<span data-ttu-id="2fcc0-180">WPF のドキュメント</span><span class="sxs-lookup"><span data-stu-id="2fcc0-180">Documents in WPF</span></span>](documents-in-wpf.md)
