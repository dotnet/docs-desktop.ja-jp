---
title: '方法: 問題のある印刷ジョブを診断する'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- troubleshooting print job problems [WPF]
- print jobs [WPF], troubleshooting
- print jobs [WPF], diagnosing problems
ms.assetid: b081a170-84c6-48f9-a487-5766a8d58a82
ms.openlocfilehash: ce79818b16824969ef0bd2a9c8adfd7ca094cec0
ms.sourcegitcommit: 9f6df084c53a3da0ea657ed0d708a72213683084
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/09/2020
ms.locfileid: "96974877"
---
# <a name="how-to-diagnose-problematic-print-job"></a><span data-ttu-id="ae2ef-102">方法: 問題のある印刷ジョブを診断する</span><span class="sxs-lookup"><span data-stu-id="ae2ef-102">How to: Diagnose Problematic Print Job</span></span>
<span data-ttu-id="ae2ef-103">印刷ジョブで印刷を実行できない、印刷速度が遅い、などのユーザーからの苦情に、ネットワーク管理者が対処することはよくあります。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-103">Network administrators often field complaints from users about print jobs that do not print or print slowly.</span></span> <span data-ttu-id="ae2ef-104">Microsoft .NET Framework の API で公開されているさまざまな印刷ジョブのプロパティには、印刷ジョブを迅速にリモート診断する手段が用意されています。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-104">The rich set of print job properties exposed in the APIs of Microsoft .NET Framework provide a means for performing a rapid remote diagnosis of print jobs.</span></span>  
  
## <a name="example"></a><span data-ttu-id="ae2ef-105">例</span><span class="sxs-lookup"><span data-stu-id="ae2ef-105">Example</span></span>  
 <span data-ttu-id="ae2ef-106">このようなユーティリティを作成する主な手順は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-106">The major steps for creating this kind of utility are as follows.</span></span>  
  
1. <span data-ttu-id="ae2ef-107">ユーザーから苦情が出ている印刷ジョブを特定します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-107">Identify the print job that the user is complaining about.</span></span> <span data-ttu-id="ae2ef-108">ユーザーがそのジョブを正確に特定できないことはよくあります。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-108">Users often cannot do this precisely.</span></span> <span data-ttu-id="ae2ef-109">プリント サーバーやプリンターの名前がわからないのかもしれません。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-109">They may not know the names of the print servers or printers.</span></span> <span data-ttu-id="ae2ef-110">プリンターの場所の記述に使用されている用語が、<xref:System.Printing.PrintQueue.Location%2A> プロパティの設定で使用されたものとは異なる可能性もあります。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-110">They may describe the location of the printer in different terminology than was used in setting its <xref:System.Printing.PrintQueue.Location%2A> property.</span></span> <span data-ttu-id="ae2ef-111">そこで、ユーザーが現在送信しているジョブのリストを生成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-111">Accordingly, it is a good idea to generate a list of the user's currently submitted jobs.</span></span> <span data-ttu-id="ae2ef-112">ジョブが複数存在する場合は、ユーザーと印刷システム管理者の間の通信を使用して、問題のあるジョブを特定できます。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-112">If there is more than one, then communication between the user and the print system administrator can be used to pinpoint the job that is having problems.</span></span> <span data-ttu-id="ae2ef-113">その手順を次に示します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-113">The substeps are as follows.</span></span>  
  
    1. <span data-ttu-id="ae2ef-114">プリント サーバーの一覧を取得します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-114">Obtain a list of all print servers.</span></span>  
  
    2. <span data-ttu-id="ae2ef-115">サーバーをループして、印刷キューを照会します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-115">Loop through the servers to query their print queues.</span></span>  
  
    3. <span data-ttu-id="ae2ef-116">サーバー ループの各パス内で、すべてのサーバーのキューをループして、ジョブを照会します</span><span class="sxs-lookup"><span data-stu-id="ae2ef-116">Within each pass of the server loop, loop through all the server's queues to query their jobs</span></span>  
  
    4. <span data-ttu-id="ae2ef-117">キュー ループの各パス内で、ジョブをループし、苦情を訴えているユーザーが送信したジョブに関する識別情報を収集します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-117">Within each pass of the queue loop, loop through its jobs and gather identifying information about those that were submitted by the complaining user.</span></span>  
  
2. <span data-ttu-id="ae2ef-118">問題のある印刷ジョブを特定したら、関連するプロパティを調べて、</span><span class="sxs-lookup"><span data-stu-id="ae2ef-118">When the problematic print job has been identified, examine relevant properties to see what might be the problem.</span></span> <span data-ttu-id="ae2ef-119">ジョブがエラー状態になっていないか、キューにサービスを提供しているプリンターがジョブの印刷前にオフラインになっていないか、など、何が問題になっているかを確認します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-119">For example, is job in an error state or did the printer servicing the queue go offline before the job could print?</span></span>  
  
 <span data-ttu-id="ae2ef-120">一連のコード例を以下に示します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-120">The code below is series of code examples.</span></span> <span data-ttu-id="ae2ef-121">最初のコード例には、印刷キューのループが示されています</span><span class="sxs-lookup"><span data-stu-id="ae2ef-121">The first code example contains the loop through the print queues.</span></span> <span data-ttu-id="ae2ef-122">(前の手順 1c. を参照)。変数 `myPrintQueues` は、現在のプリント サーバーに対する <xref:System.Printing.PrintQueueCollection> オブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-122">(Step 1c above.) The variable `myPrintQueues` is the <xref:System.Printing.PrintQueueCollection> object for the current print server.</span></span>  
  
 <span data-ttu-id="ae2ef-123">このコード例では、まず現在の印刷キューのオブジェクトを <xref:System.Printing.PrintQueue.Refresh%2A?displayProperty=nameWithType> で更新します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-123">The code example begins by refreshing the current print queue object with <xref:System.Printing.PrintQueue.Refresh%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="ae2ef-124">これにより、オブジェクトのプロパティが、オブジェクトに示される物理プリンターの状態を正確に表すようになります。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-124">This ensures that the object's properties accurately represent the state of the physical printer that it represents.</span></span> <span data-ttu-id="ae2ef-125">その後、アプリケーションで <xref:System.Printing.PrintQueue.GetPrintJobInfoCollection%2A> を使用して、現在印刷キューに存在する印刷ジョブのコレクションを取得します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-125">Then the application gets the collection of print jobs currently in the print queue by using <xref:System.Printing.PrintQueue.GetPrintJobInfoCollection%2A>.</span></span>  
  
 <span data-ttu-id="ae2ef-126">次に、アプリケーションで <xref:System.Printing.PrintSystemJobInfo> コレクションをループ処理し、各 <xref:System.Printing.PrintSystemJobInfo.Submitter%2A> プロパティと、苦情を訴えているユーザーのエイリアスを比較します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-126">Next the application loops through the <xref:System.Printing.PrintSystemJobInfo> collection and compares each <xref:System.Printing.PrintSystemJobInfo.Submitter%2A> property with the alias of the complaining user.</span></span> <span data-ttu-id="ae2ef-127">一致した場合、アプリケーションは、ジョブに関する識別情報を、表示される文字列に追加します</span><span class="sxs-lookup"><span data-stu-id="ae2ef-127">If they match, the application adds identifying information about the job to the string that will be presented.</span></span> <span data-ttu-id="ae2ef-128">(`userName` 変数と `jobList` 変数は、前にアプリケーションで初期化されています)。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-128">(The `userName` and `jobList` variables are initialized earlier in the application.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#enumeratejobsinqueues)]
 [!code-csharp[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#enumeratejobsinqueues)]
 [!code-vb[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#enumeratejobsinqueues)]  
  
 <span data-ttu-id="ae2ef-129">次のコード例では、手順 2. のアプリケーションを取り上げます</span><span class="sxs-lookup"><span data-stu-id="ae2ef-129">The next code example picks up the application at Step 2.</span></span> <span data-ttu-id="ae2ef-130">(前の説明を参照)。問題のあるジョブが特定され、その問題に関する情報を入力するように求められます。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-130">(See above.) The problematic job has been identified and the application prompts for the information that will identify it.</span></span> <span data-ttu-id="ae2ef-131">この情報から、<xref:System.Printing.PrintServer>、<xref:System.Printing.PrintQueue>、<xref:System.Printing.PrintSystemJobInfo> の各オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-131">From this information it creates <xref:System.Printing.PrintServer>, <xref:System.Printing.PrintQueue>, and <xref:System.Printing.PrintSystemJobInfo> objects.</span></span>  
  
 <span data-ttu-id="ae2ef-132">この時点で、アプリケーションは分岐構造になっており、印刷ジョブの状態を確認する 2 つの方法に対応しています。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-132">At this point the application contains a branching structure corresponding to the two ways of checking a print job's status:</span></span>  
  
- <span data-ttu-id="ae2ef-133"><xref:System.Printing.PrintJobStatus> 型の <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> プロパティのフラグを読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-133">You can read the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property which is of type <xref:System.Printing.PrintJobStatus>.</span></span>  
  
- <span data-ttu-id="ae2ef-134"><xref:System.Printing.PrintSystemJobInfo.IsBlocked%2A> や <xref:System.Printing.PrintSystemJobInfo.IsInError%2A> など、関連する各プロパティを読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-134">You can read each relevant property such as <xref:System.Printing.PrintSystemJobInfo.IsBlocked%2A> and <xref:System.Printing.PrintSystemJobInfo.IsInError%2A>.</span></span>  
  
 <span data-ttu-id="ae2ef-135">この例では両方の方法が示されています。したがって、<xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> プロパティのフラグを使用するユーザーは、以前に使用する方法に関する指定を求められたときに、"Y" と応答しました。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-135">This example demonstrates both methods, so the user was previously prompted as to which method to use and responded with "Y" if they wanted to use the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property.</span></span> <span data-ttu-id="ae2ef-136">2 つの方法の詳細については、以下を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-136">See below for the details of the two methods.</span></span> <span data-ttu-id="ae2ef-137">最後に、アプリケーションは **ReportQueueAndJobAvailability** というメソッドを使用して、現在ジョブを印刷できるかどうかを報告します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-137">Finally, the application uses a method called **ReportQueueAndJobAvailability** to report on whether the job can be printed at this time of day.</span></span> <span data-ttu-id="ae2ef-138">このメソッドについては、「[方法: 現在、印刷ジョブが印刷可能であるかどうかを検出する](how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day.md)」で説明しています。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-138">This method is discussed in [Discover Whether a Print Job Can Be Printed At This Time of Day](how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day.md).</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#identifyanddiagnoseproblematicjob)]
 [!code-csharp[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#identifyanddiagnoseproblematicjob)]
 [!code-vb[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#identifyanddiagnoseproblematicjob)]  
  
 <span data-ttu-id="ae2ef-139"><xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> プロパティのフラグを使用して、印刷ジョブの状態を確認するには、各関連フラグが設定されているかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-139">To check print job status using the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property, you check each relevant flag to see if it is set.</span></span> <span data-ttu-id="ae2ef-140">1 ビットがビット フラグ セットで設定されているかどうかを確認するには、通常、フラグ セットを 1 つのオペランドとし、フラグ自体をもう 1 つのオペランドとして、論理 AND 演算を行います。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-140">The standard way to see if one bit is set in a set of bit flags is to perform a logical AND operation with the set of flags as one operand and the flag itself as the other.</span></span> <span data-ttu-id="ae2ef-141">フラグ自体には 1 ビットのみが設定されているため、論理 AND の結果は、その同じビットが上限となります。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-141">Since the flag itself has only one bit set, the result of the logical AND is that, at most, that same bit is set.</span></span> <span data-ttu-id="ae2ef-142">それが該当するかどうかを確認するには、論理 AND の結果とフラグ自体を比較します。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-142">To find out whether it is or not, just compare the result of the logical AND with the flag itself.</span></span> <span data-ttu-id="ae2ef-143">詳細については、<xref:System.Printing.PrintJobStatus>、[& 演算子 (C# リファレンス)](/dotnet/csharp/language-reference/operators/bitwise-and-shift-operators#logical-and-operator-)、および <xref:System.FlagsAttribute> に関する記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-143">For more information, see <xref:System.Printing.PrintJobStatus>, the [& Operator (C# Reference)](/dotnet/csharp/language-reference/operators/bitwise-and-shift-operators#logical-and-operator-), and <xref:System.FlagsAttribute>.</span></span>  
  
 <span data-ttu-id="ae2ef-144">次のコードでは、ビットが設定されている属性ごとにこの報告をコンソール画面に表示し、場合によっては応答方法を示します</span><span class="sxs-lookup"><span data-stu-id="ae2ef-144">For each attribute whose bit is set, the code reports this to the console screen and sometimes suggests a way to respond.</span></span> <span data-ttu-id="ae2ef-145">(ジョブまたはキューが一時停止されている場合に呼び出される **HandlePausedJob** メソッドについては、後で説明します)。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-145">(The **HandlePausedJob** method that is called if the job or queue is paused is discussed below.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#spottroubleusingjobattributes)]
 [!code-csharp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#spottroubleusingjobattributes)]
 [!code-vb[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#spottroubleusingjobattributes)]  
  
 <span data-ttu-id="ae2ef-146">個別のプロパティを使用して印刷ジョブの状態を確認するには、単に各プロパティを読み取り、プロパティが `true` の場合は報告をコンソール画面に表示し、場合によっては応答方法を示します</span><span class="sxs-lookup"><span data-stu-id="ae2ef-146">To check print job status using separate properties, you simply read each property and, if the property is `true`, report to the console screen and possibly suggest a way to respond.</span></span> <span data-ttu-id="ae2ef-147">(ジョブまたはキューが一時停止されている場合に呼び出される **HandlePausedJob** メソッドについては、後で説明します)。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-147">(The **HandlePausedJob** method that is called if the job or queue is paused is discussed below.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#spottroubleusingjobproperties)]
 [!code-csharp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#spottroubleusingjobproperties)]
 [!code-vb[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#spottroubleusingjobproperties)]  
  
 <span data-ttu-id="ae2ef-148">**HandlePausedJob** メソッドを使用すると、アプリケーションのユーザーが、一時停止されているジョブをリモートで再開できます。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-148">The **HandlePausedJob** method enables the application's user to remotely resume paused jobs.</span></span> <span data-ttu-id="ae2ef-149">印刷キューが正当な理由で一時停止している可能性があるため、まず、印刷キューを再開するかどうかを確認するメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-149">Because there might be a good reason why the print queue was paused, the method begins by prompting for a user decision about whether to resume it.</span></span> <span data-ttu-id="ae2ef-150">"Y" と応答すると、<xref:System.Printing.PrintQueue.Resume%2A?displayProperty=nameWithType> メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-150">If the answer is "Y", then the <xref:System.Printing.PrintQueue.Resume%2A?displayProperty=nameWithType> method is called.</span></span>  
  
 <span data-ttu-id="ae2ef-151">次に、ユーザーはジョブ自体を再開するかどうかを確認するよう求められます。これは、そのジョブが印、刷キューとは関係なく一時停止されている可能性もあるためです</span><span class="sxs-lookup"><span data-stu-id="ae2ef-151">Next the user is prompted to decide if the job itself should be resumed, just in case it is paused independently of the print queue.</span></span> <span data-ttu-id="ae2ef-152">(<xref:System.Printing.PrintQueue.IsPaused%2A?displayProperty=nameWithType> と <xref:System.Printing.PrintSystemJobInfo.IsPaused%2A?displayProperty=nameWithType> を比較します)。"Y" と応答すると、<xref:System.Printing.PrintSystemJobInfo.Resume%2A?displayProperty=nameWithType> が呼び出されます。それ以外の場合は、<xref:System.Printing.PrintSystemJobInfo.Cancel%2A> が呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="ae2ef-152">(Compare <xref:System.Printing.PrintQueue.IsPaused%2A?displayProperty=nameWithType> and <xref:System.Printing.PrintSystemJobInfo.IsPaused%2A?displayProperty=nameWithType>.) If the answer is "Y", then <xref:System.Printing.PrintSystemJobInfo.Resume%2A?displayProperty=nameWithType> is called; otherwise <xref:System.Printing.PrintSystemJobInfo.Cancel%2A> is called.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#handlepausedjob)]
 [!code-csharp[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#handlepausedjob)]
 [!code-vb[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#handlepausedjob)]  
  
## <a name="see-also"></a><span data-ttu-id="ae2ef-153">関連項目</span><span class="sxs-lookup"><span data-stu-id="ae2ef-153">See also</span></span>

- <xref:System.Printing.PrintJobStatus>
- <xref:System.Printing.PrintSystemJobInfo>
- <xref:System.FlagsAttribute>
- <xref:System.Printing.PrintQueue>
- [<span data-ttu-id="ae2ef-154">& 演算子 (C# リファレンス)</span><span class="sxs-lookup"><span data-stu-id="ae2ef-154">& Operator (C# Reference)</span></span>](/dotnet/csharp/language-reference/operators/bitwise-and-shift-operators#logical-and-operator-)
- [<span data-ttu-id="ae2ef-155">WPF のドキュメント</span><span class="sxs-lookup"><span data-stu-id="ae2ef-155">Documents in WPF</span></span>](documents-in-wpf.md)
- [<span data-ttu-id="ae2ef-156">印刷の概要</span><span class="sxs-lookup"><span data-stu-id="ae2ef-156">Printing Overview</span></span>](printing-overview.md)
